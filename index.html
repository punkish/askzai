<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zai</title>
    <meta name="description" content="answering questions since before it was cool">
    <head prefix="og: http://ogp.me/ns#">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Ask Zai">
    <link rel="apple-touch-icon" sizes="180x180" href="img/icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="img/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="img/icons/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="stylesheet" href="css/uglyduck.css">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/pop-pop.min.css">
</head>
<body>
    <header>
        <!-- https://www.fontspace.com/category/lightning -->
        <img id="home" src="img/zai.png" width="40" alt="Zai home">
        <nav>
            <ul>
                <li><a href="/index.html">Zai</a></li>
                <li><a href="/about.html" class="route">About</a></li>
                <li><a href="/how-this-works.html" class="route">Info</a></li>
            </ul>
        </nav>
    </header>
    <main>
        <section id="index">
            <form>
                <div id="form-wrapper">
                    <div id="q" contentEditable="true" 
                        data-text="Ask me something!" 
                        spellcheck="false"></div>
                    <input id="q_shadow" type="hidden" value="">
                    <div id="buttons">
                        <button id="reset" type="reset" 
                            aria-label="reset search" data-pop="top" 
                            data-pop-no-shadow data-pop-arrow>&#8855;</button>
                        <button id="go" type="submit">→</button> 
                    </div>
                </div>
                <details id="example-queries">
                    <summary>example queries</summary>
                    <div>
                        <p>Keep the queries short, no more than 3-5 words long. Focus on a single task and a single species, and <i>include</i> the <span class="species-name">species name</span> in the query. This allows a more focused context to be presented to the LLM. Here are a few examples to get you started:</p>
                        <ul id="dropdown">
                            <li>What is <span class="species-name">Saigona baiseensis</span>?</li>
                            <li>Describe <span class="species-name">Saigona sinicola</span></li>
                            <li>Describe <span class="species-name">Carvalhoma malcolmae</span></li>
                            <li>Does <span class="species-name">Rhinolophus sinicus</span> live in caves?</li>
                            <li>Where does <span class="species-name">Laephotis botswanae</span> roost?</li>
                            <li>What distinguishes <span class="species-name">Choanolaimus sparsiporus</span>?</li>
                            <li>What is the etymology of <span class="species-name">Gammanema lunatum</span>?</li>
                            <li>Describe <span class="species-name">Amnestus sinuosus</span></li>
                        </ul>
                    </div>
                </details>
            </form>

            <div id="responses">
                <div id="response"></div>
                <div id="answer"></div>
                <div id="relatedImages" class="columns"></div>
                <div id="source"></div>
            </div>
        </section>
        
        <section id="about" class="hidden">
            <a class="route backhome" href="/index.html">←</a>
            <h2>About</h2>
            <p>This is a Plazi production.</p>
        </section>

        <section id="how-this-works" class="hidden">
            <a class="route backhome" href="/index.html">←</a>
            <h2>How this works</h2>
            <pre>
                  ┌───────────┐                        
                  │what is the│                        
    ┌────────────▶│meaning of │                        
    │             │life?      │                        
  asks            └───────────┘                        
    │                   │                              
    │        ┌ ─ ─ ─ ─ ─│─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ 
  ┌────┐                │          semantic cache^    │
  │\O/ │     │    ┌─────▼─────┐                        
  │ |  │      yes │is the     │           ┌──────┐    │
  │/ \ │◀──42┼────│answer in  │──────────▶│cache │     
  │user│          │cache?     │           └───▲──┘    │
  └────┘     │    └───────────┘               │        
                       no                     │       │
             └ ─ ─ ─ ─ ─│─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─│─ ─ ─ ─ 
                        │                     │        
               ┌────────▼───────┐             │        
               │remove stopwords│       ┌─────┴────┐   
               │"what", "is",   │       │ response │   
               │"the", and "of" │       └─────▲────┘   
               └────────┬───────┘             │        
                        │               ┌─────┴────┐   
               ┌────────▼───────┐       │   LLM    │   
               │full text search│       └─────▲────┘   
               │of "meaning" and│             │        
               │"life"          │             │        
               └────────┬───────┘    ┌────────┴───────┐
                        │            │question: "what │
                        │            │is the meaning  │
                        │            │of life?"       │
                        │    top   ─▶│                │
                        │   ranked   │context: full   │
                        │   paper    │text of the     │
                 ┌──────▼─────┐  │   │paper           │
                 │papers      │  │   └────────────────┘
                 │ranked by   │──┘                     
                 │relevance   │                        
                 └────────────┘                        
            </pre>
            <p>We are using Alibaba's opensource <a href="https://qwenlm.github.io/blog/qwen3/" target="_blank">Qwen 3:0.6b</a> to generate answers to questions based on the context provided. The context is chosen from the full text search result of the relevant tokens in your query ranked by their relevance (BM25 score).</p>

            <p>^ Semantic cache is not yet implemented</p>
        </section>
    </main>
    <footer>
        <p>Published under the <a href="https://creativecommons.org/publicdomain/zero/1.0/legalcode">CC0 public domain dedication</a></p>
    </footer>
    <script src="js/lazysizes.min.js"></script>
    <script type="module">
        import { $, $$ } from './js/utils.js';
        import { Router, reroute } from './js/router.js';   
        import { onPageLoad, submitForm, go, reset, tweakUrl } from './js/askzai.js';

        const routes = Array.from($$('.route')).map(link => { 
            return {
                link, 
                path: link.getAttribute('href'),
                component: () => reroute(
                    link.getAttribute('href')
                        .replace('/', '')
                        .replace('.html', '')
                )
            }
        });

        const router = new Router(routes);
        document.addEventListener('DOMContentLoaded', (event) => onPageLoad(router));
        $('form').addEventListener('submit', submitForm);
        tweakUrl(window.location.href);

        $$('#dropdown li').forEach((item) => {
            item.addEventListener('click', (e) => {
                e.preventDefault();
                const input = $('#q');
                input.innerText = e.target.tagName === 'SPAN' 
                    ? e.target.parentNode.innerText
                    : e.target.innerText;
                document.querySelector('#example-queries').open = false;
                go(input.innerText);
            });
        });

        // https://stackoverflow.com/a/33239883
        $("#q").addEventListener("keydown", function(e){

            //if enter key is pressed
            if(e.keyCode== 13 || e.which== 13) { 
                e.preventDefault();
                submitForm(e);
            }
        });
    </script>
</body>
</html>