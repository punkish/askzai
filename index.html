<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zai</title>
    <meta name="description" content="answering questions since before it was cool">
    <head prefix="og: http://ogp.me/ns#">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Zai">
    <link rel="apple-touch-icon" sizes="180x180" href="img/icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="img/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="img/icons/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="stylesheet" href="css/uglyduck.css">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/pop-pop.min.css">
</head>
<body>
    <header>
        <!-- https://www.fontspace.com/category/lightning -->
        <img id="home" src="img/zai.png" width="40" alt="Zai home">
        <nav>
            <ul>
                <li><a href="/index.html">Zai</a></li>
                <li><a href="/about.html" class="route">About</a></li>
                <li><a href="/how-this-works.html" class="route">Info</a></li>
            </ul>
        </nav>
    </header>
    <main>
        <section id="index">
            <form>
                <div id="form-wrapper">
                    <div id="q_container">
                        <div id="q_shadow" class="obscure"></div>
                        <input type="text" id="q" name="q" placeholder="Ask me something!"> 
                    </div>
                    <div id="buttons">
                        <button id="reset" type="reset" aria-label="reset search" 
                            data-pop="top" data-pop-no-shadow  
                            data-pop-arrow>&#8855;</button>
                            <button id="go" type="submit">→</button> 
                    </div>
                </div>
                <details id="example-queries">
                    <summary>
                        example queries
                    </summary>
                    <div>
                        <p>Keep the queries short, three to five words long. Focus on a single task and a single species, and include the name of the species in the query. These tricks allow a more focused context to be presented to the LLM. Here are a few examples to get you started:</p>
                        <ul id="dropdown">
                            <li>What is Saigona baiseensis?</li>
                            <li>Describe Saigona sinicola</li>
                            <li>Describe Carvalhoma malcolmae</li>
                            <li>Does Rhinolophus sinicus live in caves?</li>
                            <li>Where does Laephotis botswanae roost?</li>
                        </ul>
                    </div>
                </details>
            </div>
            </form>

            <div id="response"></div>
            <div id="answer"></div>
            <div id="relatedImages" class="columns"></div>
            <div id="source"></div>
        </section>
        
        <section id="about" class="hidden">
            <a class="route backhome" href="/index.html">←</a>
            <h2>About</h2>
            <p>This is a Plazi production.</p>
        </section>

        <section id="how-this-works" class="hidden">
            <a class="route backhome" href="/index.html">←</a>
            <h2>How this works</h2>
            <pre>
                ┌───────────┐                        
                │what is the│                        
  ┌────────────▶│meaning of │                        
  │             │life?      │                        
asks            └───────────┘                        
  │                   │                              
  │        ┌ ─ ─ ─ ─ ─│─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ 
  │                   │          semantic cache^    │
  │        │    ┌─────▼─────┐                        
┌────┐       yes│is the     │           ┌──────┐    │
│user│◀─42─┼────│answer in  │──────────▶│cache │     
└────┘          │cache?     │           └───▲──┘    │
           │    └───────────┘               │        
                     no                     │       │
           └ ─ ─ ─ ─ ─│─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─│─ ─ ─ ─ 
                      │                     │        
             ┌────────▼───────┐             │        
             │remove stopwords│       ┌─────┴────┐   
             │"what", "is",   │       │ response │   
             │"the", and "of" │       └─────▲────┘   
             └────────┬───────┘             │        
                      │                     │        
             ┌────────▼───────┐       ┌─────┴────┐   
             │full text search│       │   LLM    │   
             │of "meaning" and│       └─────▲────┘   
             │"life"          │             │        
             └────────┬───────┘             │        
                      │            ┌────────┴───────┐
                      │            │question: "what │
               ┌──────▼─────┐      │is the meaning  │
               │papers      │      │of life?"       │
               │ranked by   │─────▶│                │
               │relevance   │      │context: top    │
               └────────────┘      │ranked paper    │
                                   └────────────────┘
            </pre>
            <p>We use Meta's opensource <b>Llama 3.2:latest</b> to generate answers to questions based on the context provided. The context is chosen from the full text search result of the relevant tokens in your query ranked by their relevance (BM25 score).</p>

            <p>^ Semantic cache is not yet implemented</p>
        </section>
    </main>
    <footer>
        <p>Published under the <a href="https://creativecommons.org/publicdomain/zero/1.0/legalcode">CC0 public domain dedication</a></p>
    </footer>
    <script src="js/lazysizes.min.js"></script>
    <script type="module">
        import { $, $$ } from './js/utils.js';
        import { Router, reroute } from './js/router.js';   
        import { onPageLoad, submitForm, go, reset, tweakUrl } from './js/zaiweb.js';

        const routes = Array.from($$('.route')).map(link => { 
            return {
                link, 
                path: link.getAttribute('href'),
                component: () => reroute(
                    link.getAttribute('href')
                        .replace('/', '')
                        .replace('.html', '')
                )
            }
        });

        const router = new Router(routes);
        document.addEventListener('DOMContentLoaded', (event) => onPageLoad(router));
        $('form').addEventListener('submit', submitForm);
        tweakUrl(window.location.href);

        // function revealExamples() {
        //     $('#example-queries div').classList.toggle('hidden');
        // }

        // $('#example-queries h4').addEventListener('click', (e) => {
        //     e.preventDefault();
        //     revealExamples();
        // });

        $$('#dropdown li').forEach((item) => {
            item.addEventListener('click', (e) => {
                e.preventDefault();
                const input = $('#q');
                input.value = e.target.innerText;
                document.querySelector('#example-queries').open = false;
                // revealExamples();
                go(input.value);
            });
        });
    </script>
</body>
</html>