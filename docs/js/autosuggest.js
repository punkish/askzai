import{$,getInputText,moveCursorToEnd}from"./utils.js";const SpeciesAutosuggest=(()=>{let e,t,n,o,s,r,i=[],a=-1,c=!1;const l=e=>e.length>=1&&"describe"===e[0].toLowerCase(),u=()=>{n.style.display="none",a=-1},d=e=>{n.querySelectorAll(".suggestion-item").forEach((t,n)=>{n===e?t.classList.add("highlighted"):t.classList.remove("highlighted")})},p=t=>{const n=`Describe ${t}`;e.textContent=n,moveCursorToEnd(e),u(),e.focus()},g=e=>{0!==e.length?(n.innerHTML="",i=e,a=-1,e.forEach((e,t)=>{const o=document.createElement("div");o.className="suggestion-item",o.setAttribute("role","option"),o.setAttribute("data-index",t),o.innerHTML=`<span class="species-name">${e}</span>`,o.addEventListener("click",()=>p(e)),n.appendChild(o)}),n.style.display="block"):u()};const m=function(e,t=300){let n;return function(){clearTimeout(n),n=setTimeout(e,t)}}(async()=>{if(c)return void(c=!1);const t=getInputText(e);if((e=>{const t=e.trim().toLowerCase().split(/\s+/);return l(t)})(t)){const e=(e=>{const t=e.trim().split(/\s+/);return l(t)?t.slice(1).join(" ").toLowerCase():""})(t);if(e.length>2){const t=await s(e);t&&g(t)}}else u()}),v=t=>{const o="none"!==n.style.display,s=i.length>0;let r=!1;if(r&&(e.contentEditable=!1),o&&s)switch(t.key){case"ArrowDown":return t.preventDefault(),t.stopPropagation(),c=!0,a<i.length-1?a++:a=0,d(a),!1;case"ArrowUp":return t.preventDefault(),t.stopPropagation(),c=!0,a>0?a--:a=i.length-1,d(a),!1;case"Enter":if(r=a>=0&&a<i.length,r)return t.preventDefault(),t.stopPropagation(),p(i[a]),e.contentEditable=!1,f(t),!1;break;case"Escape":return t.preventDefault(),t.stopPropagation(),u(),!1}else if("Enter"===t.key)return t.preventDefault(),t.stopPropagation(),e.contentEditable=!1,f(t),!1},f=t=>{t.preventDefault();const n=getInputText(e);if(n.length<3){const e=$("#placeholder-overlay"),t=e.innerHTML;e.innerHTML="C'mon now, ask something!",e.classList.add("warning"),setTimeout(()=>{e.innerHTML=t,e.classList.remove("warning")},3e3)}else r(n)},L=t=>{e.contains(t.target)||n.contains(t.target)||u()};return{init:(i={})=>(e=i.input,t=i.id,n=i.suggestionsContainer,o=i.form,s=i.getSpecies,r=i.doSomethingWithData,e?n?o?(e.addEventListener("input",m),e.addEventListener("keyup",m),e.addEventListener("keydown",v),o.addEventListener("submit",f),document.addEventListener("click",L),window.focusOnInput&&e.focus(),!0):(console.error("Required DOM element form not found"),!1):(console.error("Required DOM element suggestionsContainer not found"),!1):(console.error("Required DOM element input not found"),!1)),destroy:()=>{e&&n&&o&&(e.removeEventListener("input",m),e.removeEventListener("keyup",m),e.removeEventListener("keydown",v),o.removeEventListener("submit",f),document.removeEventListener("click",L))},getCurrentSuggestions:()=>[...i]}})();export default SpeciesAutosuggest;